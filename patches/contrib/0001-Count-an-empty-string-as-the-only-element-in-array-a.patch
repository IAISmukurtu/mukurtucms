From e1e88bedffa77fec817795abf0ffc9b07e0fbd95 Mon Sep 17 00:00:00 2001
From: Steve Taylor <steve_taylor@wsu.edu>
Date: Fri, 8 Dec 2017 16:25:16 -0800
Subject: [PATCH] Count an empty string as the only element in array as being
 "empty"

---
 sites/all/modules/contrib/feeds_tamper/plugins/required.inc | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/sites/all/modules/contrib/feeds_tamper/plugins/required.inc b/sites/all/modules/contrib/feeds_tamper/plugins/required.inc
index aa37d21..82bb370 100644
--- a/plugins/required.inc
+++ b/plugins/required.inc
@@ -47,7 +47,13 @@ function feeds_tamper_required_callback($result, $item_key, $element_key, &$fiel
   }
 
   if (!empty($field) || $field == '0') {
+      // Mukurtu specific change. Because of the changes we've made to allow partial
+      // updates in feeds imports, not all fields get cleared. This means we end up with
+      // some untouched fields having single element arrays that contain a single empty
+      // string. We check for that here and count that as missing.
+      if(!(is_array($field) && count($field) == 1 && isset($field[0]) && empty($field[0]))) {
     return;
+      }
   }
 
   unset($result->items[$item_key]);
-- 
2.7.4

